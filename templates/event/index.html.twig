{% extends 'base.html.twig' %}

{% block title %}Liste des sorties{% endblock %}

{% block body %}

<div class="container mt-5">
    <h3>Filtrer les sorties</h3>
    <div class="row">
        <div class="col">
            <div class="dropdown">
                <button class="btn btn-light dropdown-toggle" type="button" id="dropdownMenuButton1" data-bs-toggle="dropdown" aria-expanded="false">
                    Site
                </button>
                <ul class="dropdown-menu" aria-labelledby="dropdownMenuButton1">
                    <li><a class="dropdown-item" href="#">Action</a></li>
                    <li><a class="dropdown-item" href="#">Another action</a></li>
                    <li><a class="dropdown-item" href="#">Something else here</a></li>
                </ul>
            </div>
            <div class="col-6">
                <div class="mb-3">
                    <label for="inputSearchEvent" class="form-label">Recherche une sortie</label>
                    <input type="text" class="form-control" id="inputSearchEvent" placeholder="Cinéma">
                </div>
            </div>
            <div class="date-style">
                <label for="start_date">Entre </label>
                <input type="date" id="start_date" name="trip-start" value="" />
            </div>
            <div class="date-style">
                <label for="end_date">et </label>
                <input type="date" id="end_date" name="trip-start" value=""  />
            </div>

            <button class="col-3 btn btn-primary" type="submit" >Recherche</button>
        </div>
        <div class="col">
            <div class="form-check">
                <input class="form-check-input" type="checkbox" value="" id="chkOrg">
                <label class="form-check-label" for="chkOrg">
                    Sorties dont je suis l'organisateur/trice
                </label>
            </div>
            <div class="form-check">
                <input class="form-check-input" type="checkbox" value="" id="chkInscrit">
                <label class="form-check-label" for="chkInscrit">
                    Sorties auxquelles je suis inscrit/e
                </label>
            </div>
            <div class="form-check">
                <input class="form-check-input" type="checkbox" value="" id="chkPasInscrit">
                <label class="form-check-label" for="chkPasInscrit">
                    Sorties auxquelles je ne suis pas inscrit/e
                </label>
            </div>
            <div class="form-check">
                <input class="form-check-input" type="checkbox" value="" id="chkPassed">
                <label class="form-check-label" for="chkPassed">
                    Sorties passées
                </label>
            </div>
        </div>
        <div class="text-center">
            <a class="btn-outline-primary btn" href="{{ app.request.getBaseURL() }}/create/event">Ajouter une sortie</a>
        </div>
    </div>
    <div class="mt-5">
        {% if events|length > 0 %}
            <table class="table ">
                <thead>
                <tr>
                    <th scope="col">Nom de la sortie</th>
                    <th scope="col">Date de la sortie</th>
                    <th scope="col">Clotûre</th>
                    <th scope="col">inscrits/places</th>
                    <th scope="col">Etat</th>
                    <th scope="col">Inscrit</th>
                    <th scope="col">Organisateur</th>
                    <th scope="col">Actions</th>
                </tr>
                </thead>
                <tbody>
                {% for event in events %}
                    <tr>
                        <td>{{ event.name }}</td>
                        <td>{{ event.startDateTime|date("d/m/Y") }}</td>
                        <td>{{ event.limitDateInscription|date("d/m/Y") }}</td>
                        <td>{{ event.users|length }}/{{ event.getNbInscriptionMax }}</td>
                        <td>{{ event.getStateDescription() }}</td>
                        <td>
                            {% if event.getIsSub(app.user) == true %}
                                <div class="text-center">
                                    <img src="{{ asset('./build/images/inscrit.png') }}" alt="est_inscrit" width="20px" height="20px">
                                </div>
                            {% endif %}
                        </td>
                        <td>
                            {% if event.getIsSub(app.user) == true %}
                                <a href="{{ app.request.getBaseURL() }}/profile/{{ event.user.id }}">{{ event.user.getFullName }}</a>
                            {% else %}
                                <label>{{ event.user.getFullName }}</label>
                            {% endif %}
                        </td>
                        <td>
                            {% if (event.user == app.user or is_granted('ROLE_ADMIN')) and event.state.value == "CREATED" %}
                                <a class="btn btn-outline-primary" href="{{ path('app_event_edit', {id:event.id}) }}">Modifier</a>
                                <a class="btn btn-outline-warning" href="{{ path('app_event_publish',{id:event.id}) }}">Publier</a>
                            {% else %}
                                <a class="btn btn-outline-primary" href="{{ path('app_event_details', {id:event.id}) }}">Afficher</a>
                                {% if (event.user == app.user or is_granted('ROLE_ADMIN')) and event.state.value == "OPEN" %}
                                    <a class="btn btn-outline-danger" href="{{ path('app_event_cancel', {id:event.id}) }}">Annuler</a>
                                {% elseif event.user != app.user and event.getIsSub(app.user) == 0 and event.getIsTooLateToSubscribe() == false and is_granted('ROLE_ADMIN') == false and event.state.value == "OPEN" %}
                                    <a class="btn btn-outline-warning" href="{{ path('app_event_subscribe', {id:event.id}) }}">S'inscrire</a>
                                {% elseif event.user != app.user and event.getIsSub(app.user) == 1 and event.getIsTooLateToSubscribe() == false and is_granted('ROLE_ADMIN') == false and event.state.value == "OPEN" %}
                                    <a class="btn btn-outline-warning" href="{{ path('app_event_unsubscribe', {id:event.id}) }}">Se désister</a>
                                {% endif %}
                            {% endif %}
                        </td>
                    </tr>
                {% endfor %}
                </tbody>
            </table>
        {% else %}
            <div>
                <h4 class="text-danger">Aucune sortie trouvée</h4>
            </div>
        {% endif %}

    </div>
</div>
{% endblock %}
